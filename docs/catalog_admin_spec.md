# Админка: раздел «Каталог»

## 1. Цели
- Ведение регулярных и разовых поставок (включая стендинги).
- Управление товарами, привязанными к поставкам.
- Управление акционными товарами, не связанными с поставками.
- Настройка атрибутов товара с влиянием на цену и фото.
- Поддержка мелкого опта: бронирование целых пачек из конкретной поставки.

## 2. Структура раздела «Каталог»
В меню админки появляются подпункты:
- Каталог
  - Товары
  - Акции
  - Атрибуты
  - Поставки

### 2.1. Товары
Раздел для карточек товаров, привязанных к поставкам.

#### 2.1.1. Список товаров
- Колонки: ID, наименование (клиентское), привязка к поставке («Поставка: <название> (дата)»), активность (тогглер), есть атрибуты (да/нет), базовая цена, дата создания/изменения.
- Действия: редактировать, удалить.
- Фильтры: активность, поставка, поиск по имени.

#### 2.1.2. Карточка товара
- Общие данные: привязка к поставке (обязательно), активен, клиентское наименование (обязательно), описание.
- Характеристики из поставки (read-only или подтягиваются): наименование из поставки, сорт (только для админа), цвет, страна, базовая высота стебля, вес стебля. Сорт и страна не отдаём наружу.
- Клиентские параметры: базовая цена, основное фото.
- Атрибуты товара: список выбранных атрибутов с вариантами.
- Кнопки: сохранить; удалить (при редактировании); отмена.

### 2.2. Акции
Акционные товары могут не иметь поставки; используются для аукционов, спецпредложений и распродаж.

#### 2.2.1. Список акций
- Колонки: ID, название, тип акции (sale/auction/lottery/др.), активность, период действия, цена (если применимо).
- Действия: редактировать, удалить.

#### 2.2.2. Карточка акции
- Поля: название, тип (скидка/аукцион/розыгрыш/другое), описание, цена (если релевантно), фото, период действия (начало/конец), активность.
- Опционально: привязка к товару (ID), если акция меняет цену товара; привязка к поставке необязательная и только для аналитики.

### 2.3. Атрибуты (бывшие «Варианты оформления»)
Каждый атрибут — вариант товара, меняющий цену и/или фото.

#### 2.3.1. Справочник атрибутов
- Колонки: ID, название, тип (для отображения), активность.
- Карточка: название, опциональное описание, активность.

#### 2.3.2. Значения атрибутов (варианты)
- Поля: название варианта, дополнительная цена (может быть +/0/−), фото-override, активность.
- Примеры: высота стебля («40 см» +0, «50 см» +10 ₽ + фото), оформление («Без оформления» +0, «В крафте» +30 ₽ + фото, «Подарочная упаковка» +70 ₽ + фото).

#### 2.3.3. Привязка атрибутов к товару
- В карточке товара: выбор применимых атрибутов и вариантов.
- На фронте можно показывать как селекты или готовые варианты карточек с разной ценой.

### 2.4. Поставки
Управление еженедельными/разовыми поставками, включая стендинги.

#### 2.4.1. Список поставок
- Колонки: ID, название, дата поставки, сорт, высота стебля, страна, количество пачек всего, доступные пачки, флаг «Стендинг», флаг «Мелкий опт разрешён», статус (планируется/пришла/закрыта).
- Фильтры: по дате, статусу, флагу «Стендинг».

#### 2.4.2. Карточка поставки
- Общие: название, флаг «Стендинг», дата поставки.
- Параметры: сорт, цвет, высота стебля, вес стебля (опц.), страна, комментарий поставщика (опц.).
- Учёт пачек: количество пачек всего, размер пачки (шт.), мелкий опт разрешён, системные поля (забронировано, доступно).
- Связь с товарами: список товаров из поставки (переход в карточку), кнопка «Создать товар из поставки» — черновик с авто-подтяжкой сорт/цвет/высота/страна.

#### 2.4.3. Логика мелкого опта
- При включённом мелком опте клиенты могут бронировать целые пачки на дату поставки; сумма броней не превышает общее число пачек.
- В БД: supply_id, user_id/клиент, количество пачек, дата/время, статус.

## 3. Связи между сущностями (черновая схема БД)
- supplies: id, name, is_standing, delivery_date, sort, color, height, weight, country, packs_total, pack_size, small_wholesale_enabled, status, timestamps.
- products: добавить supply_id (nullable), is_active; для обычных товаров supply_id != null, для акционных может быть null.
- promos: таблица акционных товаров (или promo_products) с необязательным product_id.
- attributes: справочник атрибутов; attribute_values: attribute_id, name, price_delta, photo; product_attribute_values: связь товар ↔ значение атрибута.
- supply_pack_reservations: supply_id, user_id, packs_reserved, status.

## 4. Бизнес-ограничения
- Сорт и страна доступны только в админке и не должны попадать в публичный API/клиентские тексты.
- Цены: базовая механика 89 ₽ за розу онлайн, спец-цена 75 ₽ для распродажи остатков; атрибуты меняют цену через price_delta.
- Привязка товара к поставке: обычный товар должен иметь supply_id; без поставки — акционный/виртуальный товар (обсуждается отдельно). Для стендингов допускается базовый товар с постоянными поставками для учёта остатков.
